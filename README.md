# GIMNTools
This module is used in order to Read and Process Data acquired in our facility. It have 
It have two main usages, read and process data from Gate simulations, and to process data
acquired in our PETSYS TOFPET2 Evaluation kit. It is In early stage of developement not being recomended 
for use outside our laboratory.

# Instalation:

todo
 

# Module composition:
GIMNTools is designed as a collection of modules each one aiming to help in some part of the process of reading and 
processing data.
*   Read
*   SpeedUpFunctions
*   Process
*   Save
*   Utils

## Read:
### *RootDataFrame( RootFilePath , AqdType)*
This class uses uproot to open the files with ease, it will check wich tipe of acquisition is it we will have two 
options, "petsys" and "gate"

*   petsys option is used to process petsys output and returns a dataframe containing all data from the AQD.
*   gate option will separate the data into singles, hits and coincidences.

AllData will be returned as a pandas Dataframe

### *AQDStructure()*
This object contains the structure for the basic output from PETSYS System, have the informations
about this informations:
* Asic : Represents the chipID number from the event
* energy: event energy
* time: time when the event was detected in pico seconds
* channel : channel who detected the event
* IMG: 8x8 matrix representing the counts in each channel
### *GIMNPETSingles(path)*
##### Both GIMNPETSingles and GIMNPETGroup are similar until the moment

This Class reads the RootFile from petsys acquisition and stores it into a data structure to
manipulate the data in a python enviroment.

    ex:
    Path = "myfile.root"
    MyAqd = GIMNPETSingles("myfile.root").GetAquisition()
    ChipID1 = MyAqd['data']['chipID1]
    energy = ChipID1.energy()
    
The methods are:
#### ProcessAQD(eWindow=False, eLow=0.0, eHigh=0.0):
This method will generate a dictionary containing the data, it allows to filter the energy in Dac Units, and
it have the following structure:
* Acquisition['name'] -> Gives the name of the File Opened
* AQD = Acquisition['data'] -> A dictionary that separates each chipID
* AQD['ChipID1'] -> inside each chipID there is a data structure that stores the following data:

        1. Asic : Represents the chipID number from the event
        2. energy: event energy 
        3. time: time when the event was detected in pico seconds
        4. channel : channel who detected the event
        5. IMG: 8x8 matrix representing the counts in each channel
    
#### GetAcquisition():
Returns the Raw data from the acquisition without any previous proces. The data returned here follows the structure
shown in **ProcessAQD**


### ProcessAsDict   

Transforms the Data-structure generated by **ProcessAQD** into a Dictionary, that allows to save it the data as
a *.matFile using Save.SaveAsMat(Data,Directory)

### LoadMat(filename):

Allows the user to read a *.mat file, it uses scipy engine to do so.


## Process
#### ProcessPETSYSRaw(PETSYSSoftwarePath, Config, File, OutName, OutPath):
This class allows to process the rawData from Petsys into Singles, Coincidences, Raws and Groups. It uses the programs
and applications provided by PETSYS Electronics, and to use this class you must have PETSYS software installed.
The imput are 5 variables:
* PETSYSSoftwarePath - Path where PETSYS Software is installed
* Config - Path where config.ini file is located
* File -  Raw File that you want to process
* OutName - Name of the output File
* OutPath - Path where the output will be saved

The values can be changed through the methods:
       
* set_PETSYSSoftwarePath
* set_Config
* set_File
* set_OutName
* set_outPath
   
The values can be visualized by the methods:
  
* PETSYSSoftwarePath
* Config
* File
* OutName
* OutPath
   
## Save

Here we have functions that allow us to save the data processed into "*.mat" files. Previously we must process the
data read by GIMNPETSingles.ProcesAQD() using the fuction ProcessAsDict that recieves de data and transforms it into a
dictionary like in order to save as "*mat".

## Utils:

### OpenFileDialog() 
Opens a window that allows you to select the desired file. It uses the TK module to do so.
returns a list with the data selected


### SelectFolder()
Opens a window that alows you to sellect a folder path by using a graphical user interface
                  it returns a string

   CreateFolder    --Creates a folder in a given directory, with a given name.
                   CreateFolder(PathToDirectory,FolderName)                   returns the directory as :
                "PathToDirectory/FolderName"

   FolderRead      --this class allows to read and show the data stored in a given folder. Its Constructor requires
                   a path, in order to display the files in it.
                   The class have 3 methods :
                   FolderRead.ListFiles    ->Returns a List containing all files in the path(with extensions)
                   FolderRead.ListDir      ->Returns a List containing the path to all files in the directory
                   FolderRead.ListFileName ->Returns a List containing all files in the path(no extensions)

### MapCreator():
Creates an object that holds the pixel-to-channel correlation matrix, it also includes methods to generate random noise
images, generates the correction "map_channel.tsv" file, that required by PETSYST TOFPET2 processing
program in order to assing a pixel position to each channel.

* SiPM: KETK PA3325-WB0808
* System : PETSYS TOFPET2 EValuation Kit
* ASIC model: BGA

Connection to J1-J2 doesnt change the pin order in the final result.

MapCreator object have 3 

#### ImageFromChannel(Channel):
This method returns a 8x8 image generated from the channel list input. Each event detected have the information of 
which channel have detected himself. In order to obtain the SiPM pixel distribution for a 8x8 SiPM we feed this function
with the channel sequence of each event.
    
#### GetMap():
Returns the Channel-to-pixel map as a list, the first each line represents a channel in the following order:
*       MAP_RETURNED[a][b]
                     ^  ^
        a -> channel number ranging from 0 to 63
        b -> 1 : x position
             2 : y position

in order to get position x from the  the 8x8 SiPM matrix, when channel is 60 do:
*       MapReturned = MapCrator().GetMap()  
        XPos = MapReturned[60][1]

#### GenerateRandomEvents(EventNum): 
Returns a channel list to generate an image, the channel list generated is random and is used in order to obtain a noisy
image in GenerateRandomImage() a noisy 8x8 image, with the event number that you desire
    
#### GenerateRandomImage(EventNum):
Returns a noisy 8x8 image, with the event number that you desire!
      
#### GenerateMapTable(Path):
generates a 'map_channel.tsv' required in order to correct the channel-sipm-position.

